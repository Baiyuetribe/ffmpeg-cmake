cmake_minimum_required(VERSION 3.10)
project(avutil)

#TODO: configure avconfig and ffversion headers
set(AVUTIL_CONFIG_HEADER avconfig.h)
set(AVUTIL_FFVERSION_HEADER ffversion.h)

file(COPY ${AVUTIL_CONFIG_HEADER} DESTINATION ${CMAKE_CURRENT_BINARY_DIR})
file(COPY ${AVUTIL_FFVERSION_HEADER} DESTINATION ${CMAKE_CURRENT_BINARY_DIR})

list(APPEND AVUTIL_PUBLIC_HEADERS samplefmt.h)
list(APPEND AVUTIL_PUBLIC_HEADERS attributes.h)
list(APPEND AVUTIL_PUBLIC_HEADERS avutil.h)
list(APPEND AVUTIL_PUBLIC_HEADERS buffer.h)
list(APPEND AVUTIL_PUBLIC_HEADERS dict.h)
list(APPEND AVUTIL_PUBLIC_HEADERS frame.h)
list(APPEND AVUTIL_PUBLIC_HEADERS log.h)
list(APPEND AVUTIL_PUBLIC_HEADERS pixfmt.h)
list(APPEND AVUTIL_PUBLIC_HEADERS rational.h)
list(APPEND AVUTIL_PUBLIC_HEADERS avassert.h)
list(APPEND AVUTIL_PUBLIC_HEADERS avstring.h)
list(APPEND AVUTIL_PUBLIC_HEADERS bprint.h)
list(APPEND AVUTIL_PUBLIC_HEADERS channel_layout.h)
list(APPEND AVUTIL_PUBLIC_HEADERS imgutils.h)
list(APPEND AVUTIL_PUBLIC_HEADERS mem.h)
list(APPEND AVUTIL_PUBLIC_HEADERS opt.h)
list(APPEND AVUTIL_PUBLIC_HEADERS thread.h)
list(APPEND AVUTIL_PUBLIC_HEADERS common.h)
list(APPEND AVUTIL_PUBLIC_HEADERS macros.h)
list(APPEND AVUTIL_PUBLIC_HEADERS version.h)
list(APPEND AVUTIL_PUBLIC_HEADERS error.h)
list(APPEND AVUTIL_PUBLIC_HEADERS mathematics.h)
list(APPEND AVUTIL_PUBLIC_HEADERS intfloat.h)
list(APPEND AVUTIL_PUBLIC_HEADERS pixdesc.h)
list(APPEND AVUTIL_PUBLIC_HEADERS hwcontext.h)

foreach(AVUTIL_HEADER ${AVUTIL_PUBLIC_HEADERS})
    file(COPY ${AVUTIL_HEADER} DESTINATION ${CMAKE_CURRENT_BINARY_DIR})
endforeach()

list(APPEND AVUTIL_SOURCES samplefmt.c)
list(APPEND AVUTIL_SOURCES utils.c)
list(APPEND AVUTIL_SOURCES buffer.c)
list(APPEND AVUTIL_SOURCES dict.c)
list(APPEND AVUTIL_SOURCES frame.c)
list(APPEND AVUTIL_SOURCES log.c)
list(APPEND AVUTIL_SOURCES rational.c)
list(APPEND AVUTIL_SOURCES avstring.c)
list(APPEND AVUTIL_SOURCES bprint.c)
list(APPEND AVUTIL_SOURCES channel_layout.c)
list(APPEND AVUTIL_SOURCES imgutils.c)
list(APPEND AVUTIL_SOURCES mem.c)
list(APPEND AVUTIL_SOURCES opt.c)
list(APPEND AVUTIL_SOURCES error.c)
list(APPEND AVUTIL_SOURCES mathematics.c)
list(APPEND AVUTIL_SOURCES pixdesc.c)
list(APPEND AVUTIL_SOURCES hwcontext.c)

add_library(avutil OBJECT ${AVUTIL_SOURCES})
add_library(avutil_static STATIC $<TARGET_OBJECTS:avutil>)

target_link_libraries(avutil PUBLIC ffmpeg_config)
target_include_directories(avutil PUBLIC ${CMAKE_BINARY_DIR}) #for config.h
